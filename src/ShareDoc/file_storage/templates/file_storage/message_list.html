{% load guardian_tags %}
{% for message in message_set %}
	<div class="message">
		{% if user.userinfo.id == message.owner.id %}
		<div class="modify_message">
			<a class="message_widget_trigger" href="{% url 'modify_message' message_id=message.id %}">修改信息</a>
			<div class="widget_loadder">
			</div>
		</div>
		{% endif %}
		<div class="display_message">
			{% get_obj_perms user for message.project as "perms" %}
			{% if message.title %}
				<p class="title">{{message.title}}</p>
			{% endif %}
			{% comment %}
			<p class="post_by">
				{{message.owner.user.username}} 发布于
				<a href="{% url 'project_message_page' project_id=message.project.id %}">{{message.project.name}}</a>项目
			</p>
			{% endcomment %}
			{% if message.description %}
			<p class="description">{{message.description}}</p>
			{% endif %}

			{% if message.file_pointers.all %}
				<div class="files">
				{% for file_pointer in message.file_pointers.all %}
					<p class="download">{{file_pointer.name}}
					{% if 'project_download' in perms %}
					<a href="{% url 'download_file' file_pointer_id=file_pointer.id%}">[download]</a>
					{% endif %}
					</p>
				{% endfor %}
				</div>
			{% endif %}
		</div>
	</div>
{% empty %}
	<div class="no_home_message">
		<p>There's no message for you.</p>
	</div>
{% endfor %}
