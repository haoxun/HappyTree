{% extends 'base_with_navigation.html' %}

{% load staticfiles %}
{% block js %}
<script src={% static 'project/project_management.js' %}></script>
{% endblock %}

{% load guardian_tags %}
{% block content %}
	<div id=project_navigation>
		<a href={% url 'project_message_page' project_id=project.id %}>Message List</a>
		<a href={% url 'project_file_list_page' project_id=project.id %}>Files Of Project</a>
		<a href={% url 'project_management_page' project_id=project.id %}>Managememt</a>
	</div>
	<div id="remove_manager">
		<p>Manager List:</p>
		<div>
		{% for user in user_set %}
			{% get_obj_perms user for project as "perms" %}
			{% get_obj_perms request.user for project as "request_user_perms" %}
			{% if "project_management" in perms %}
			<div>
				<p>{{user.username}}
				{% if "project_ownership" not in perms and "project_ownership" in request_user_perms %}
				<a href="{% url 'process_user_role_on_project' project_id=project.id user_info_id=user.userinfo.id decision="False" %}">Remove Manager</a>
				{% endif %}
				</p>
			</div>	
			{% endif %}
		{% endfor %}
		</div>

	</div>
	<div id="remove_user">
		<p>User List:</p>
		<div>
		{% for user in user_set %}
			{% get_obj_perms user for project as "perms" %}
			{% if "project_management" not in perms and "project_membership" in perms %}
			<div>
				<p>{{user.username}}
				<a href={% url 'process_user_role_on_project' project_id=project.id user_info_id=user.userinfo.id decision="True" %}>Set Manager</a> 
				<a href={% url 'delete_user_from_project' project_id=project.id user_info_id=user.userinfo.id %}>Remove</a>
				
				{% if 'project_download' in perms %}
				<a href={% url 'process_user_permission_on_project'  project_id=project.id user_info_id=user.userinfo.id kind="download" decision="False" %}>Can Download(Unset)</a>
				{% else %}
				<a href={% url 'process_user_permission_on_project'  project_id=project.id user_info_id=user.userinfo.id kind="download" decision="True" %}>Cannot Download(Set)</a>
				{% endif %}

				{% if 'project_upload' in perms %}
				<a href={% url 'process_user_permission_on_project'  project_id=project.id user_info_id=user.userinfo.id kind="upload" decision="False" %}>Can Upload(Unset)</a>
				{% else %}
				<a href={% url 'process_user_permission_on_project'  project_id=project.id user_info_id=user.userinfo.id kind="upload" decision="True" %}>Cannot Upload(Set)</a>
				{% endif %}

				{% if 'project_delete' in perms %}
				<a href={% url 'process_user_permission_on_project'  project_id=project.id user_info_id=user.userinfo.id kind="delete" decision="False" %}>Can Delete(Unset)</a>
				{% else %}
				<a href={% url 'process_user_permission_on_project'  project_id=project.id user_info_id=user.userinfo.id kind="delete" decision="True" %}>Cannot Delete(Set)</a>
				{% endif %}

				</p>
			</div>	
			{% endif %}

		{% endfor %}
		</div>
	</div>

	<div class="project_basic_info">
		<div id="display_project_name">
			Project Name: <span>{{project.name}}</span>
			<a href="#">[Change]</a>
		</div>

		<div id="modify_project_name">
			<p>Modify Project Name</p>
			<p class="error"></p>
			<form method="post" action={% url 'project_management_page' project_id=project.id %}>
				{% csrf_token %}
				{{form_project_name.as_p}}
				<input type="submit" name="project_name_submit" value="Submit"/>
				<input type="button" value="Cancel"/>
			</form>	
		</div>
	</div>

	<div class="project_basic_info">
		<div id="display_project_description">
			Project Description: <span>{{project.description}}</span>
			<a href="#">[Change]</a>
		</div>
		
		<div id="modify_project_description">
			<p>Modify Project Description</p>
			<p class="error"></p>
			<form method="post" action={% url 'project_management_page' project_id=project.id %}>
				{% csrf_token %}
				{{form_project_description.as_p}}
				<input type="submit" name="project_description_submit" value="Submit"/>
				<input type="button" value="Cancel"/>
			</form>	
		</div>
	</div>

	<div id="project_default_permission">
		<span>Defualt Member Permission: </span>
		{% if project.project_group.download %}	
		<a href={% url 'process_default_permission_on_project'  project_id=project.id kind="download" decision="False" %}>Can Download(Unset)</a>
		{% else %}
		<a href={% url 'process_default_permission_on_project'  project_id=project.id kind="download" decision="True" %}>Cannot Download(Set)</a>
		{% endif %}

		{% if project.project_group.upload %}	
		<a href={% url 'process_default_permission_on_project'  project_id=project.id kind="upload" decision="False" %}>Can Upload(Unset)</a>
		{% else %}
		<a href={% url 'process_default_permission_on_project'  project_id=project.id kind="upload" decision="True" %}>Cannot Upload(Set)</a>
		{% endif %}

		{% if project.project_group.delete %}	
		<a href={% url 'process_default_permission_on_project'  project_id=project.id kind="delete" decision="False" %}>Can Delete(Unset)</a>
		{% else %}
		<a href={% url 'process_default_permission_on_project'  project_id=project.id kind="delete" decision="True" %}>Cannot Delete(Set)</a>
		{% endif %}

	</div>

	<div class="apply_confirm">
		<p>Invite Group To Project</p>
		<p class="error"></p>
		<form method="post" action={% url 'project_management_page' project_id=project.id %}>
			{% csrf_token %}
			{{form_add_real_group.as_p}}
			<input type="submit" name="PTR_submit" value="Search"/>
		</form>	

		<div class="search_result">
		</div>
	
	</div>
	<div class="apply_confirm">
		<p>Invite User</p>
		<p class="error"></p>
		<form method="post" action={% url 'project_management_page' project_id=project.id %}>
			{% csrf_token %}
			{{form_add_user.as_p}}
			<input type="submit" name="PTU_submit" value="Search"/>
		</form>	

		<div class="search_result">
		</div>

	</div>

{% endblock %}
